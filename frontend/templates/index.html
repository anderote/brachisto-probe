<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KARDASHEV - Dyson Sphere Construction</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div id="app">
        <!-- Loading Screen with Galaxy Animation -->
        <div id="loading-screen" class="loading-screen-styled">
            <canvas id="loading-galaxy-canvas"></canvas>
            <div class="loading-content">
                <h1 class="loading-title">KARDASHEV</h1>
                <div class="loading-subtitle">INITIALIZING SIMULATION</div>
                <div class="loading-bar-container">
                    <div class="loading-bar"></div>
                </div>
                <p class="loading-status">Loading...</p>
            </div>
        </div>
        
        <!-- Compact Resource Display - Top -->
        <div id="compact-resources" class="compact-resources"></div>
        
        <!-- Main Visualization Area -->
        <div id="visualization-container">
            <canvas id="game-canvas"></canvas>
            <div id="game-overlay">
                <div class="game-title">
                    <h1>KARDASHEV</h1>
                </div>
            </div>
            <!-- Left Side Metrics Panel -->
            <div id="metrics-panel" class="metrics-panel-container"></div>
            <!-- Left Side Probe Summary Panel -->
            <div id="probe-summary-panel" class="probe-summary-panel-container"></div>
            <!-- Left Side Zone Info Panel -->
            <div id="zone-info-panel" class="zone-info-panel-container"></div>
            <!-- Zone Hover Tooltip (separate from selected zone panel) -->
            <div id="zone-hover-tooltip" class="zone-hover-tooltip" style="display: none;"></div>
            <!-- Transfer Info Overlay (shown when tracking a transfer with 't' key) -->
            <div id="transfer-info-overlay" class="transfer-info-overlay" style="display: none;"></div>
            <!-- Planet/Moon Info Overlay (shown when tracking a planet/moon) -->
            <div id="planet-moon-info-overlay" class="transfer-info-overlay" style="display: none;"></div>
            <!-- Command Panel - Center Left (separate window) -->
            <div id="command-panel-column" class="command-panel-column">
                <div id="command-panel-content"></div>
            </div>
        </div>
        
        <!-- Right Side Floating Panel -->
        <button id="right-panel-toggle" class="right-panel-toggle" title="Show/Hide Panel">
            <span id="right-panel-toggle-icon">◀</span>
        </button>
        <div id="right-panel" class="right-panel-container">
            <div class="right-panel">
                <div class="right-panel-header">
                    <div class="right-panel-tabs">
                        <button class="right-tab-btn active" data-tab="structures">Structures</button>
                        <button class="right-tab-btn" data-tab="research">Research</button>
                        <button class="right-tab-btn" data-tab="transfers">Transfers</button>
                        <button class="right-tab-btn" data-tab="probes">Stats</button>
                    </div>
                </div>
                <div class="right-panel-content">
                    <div class="right-tab-content active" id="right-tab-structures">
                        <div id="purchase-panel-content"></div>
                    </div>
                    <div class="right-tab-content" id="right-tab-research">
                        <div id="research-panel-content"></div>
                    </div>
                    <div class="right-tab-content" id="right-tab-transfers">
                        <div id="transfer-panel-content"></div>
                    </div>
                    <div class="right-tab-content" id="right-tab-probes">
                        <div id="probe-stats-panel-content"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom: Orbital Zone Selector (floating) -->
        <div id="orbital-zone-selector" class="orbital-zone-selector"></div>
        
        <!-- Bottom Left: Time Display and Speed Controls -->
        <div id="time-controls" class="time-controls"></div>

        <!-- Bottom Left: Game Menu Button -->
        <div id="game-menu-button" class="game-menu-button">
            <button id="game-menu-trigger" class="game-menu-trigger" title="Game Menu">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                </svg>
            </button>
            <div id="game-menu-dropdown" class="game-menu-dropdown" style="display: none;">
                <div class="game-menu-option" id="menu-save-game">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    Save Game
                </div>
                <div class="game-menu-option" id="menu-new-game">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    New Game
                </div>
            </div>
        </div>
        
        <!-- Performance Panel (toggleable with F key) -->
        <div id="performance-panel" class="performance-panel-container"></div>
        
        <!-- Visual Effects Debug Panel (toggleable with G key) -->
        <div id="visual-effects-panel" class="visual-effects-panel-container"></div>
        
        <!-- Summary Plot Panel (toggleable with H key) -->
        <div id="summary-plot-panel" class="summary-plot-panel-container"></div>

        <!-- Interstellar Navigation Panel (NGE-style 3D star map) -->
        <div id="interstellar-nav-panel" class="interstellar-nav-container" style="display: none;"></div>
        
        <!-- Bottom: Scripting Window (collapsible, collapsed by default) - Hidden for now -->
        <div id="scripting-window" class="scripting-window collapsed" style="display: none;">
            <div class="scripting-header">
                <span>Scripting Console</span>
                <button id="scripting-toggle">Show</button>
            </div>
            <div class="scripting-content">
                <textarea id="script-input" placeholder="Enter Python-like commands here..."></textarea>
                <div id="script-output"></div>
                <button id="script-execute">Execute</button>
            </div>
        </div>
        
        <!-- Legacy containers (hidden, for backward compatibility during transition) -->
        <div id="research-panel" class="research-panel" style="display: none;"></div>
        <div id="resource-display" class="resource-display" style="display: none;"></div>
        <div id="purchase-panel" class="purchase-panel" style="display: none;"></div>
        <div id="probe-allocation-panel" class="probe-allocation-panel" style="display: none;"></div>
        
        <!-- Login/Register Modal (Hidden for now) -->
        <div id="auth-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>KARDASHEV</h2>
                <div id="auth-forms">
                    <div id="login-form">
                        <h3>Login</h3>
                        <input type="text" id="login-username" placeholder="Username">
                        <input type="password" id="login-password" placeholder="Password">
                        <button id="login-btn">Login</button>
                        <p>Don't have an account? <a href="#" id="show-register">Register</a></p>
                    </div>
                    <div id="register-form" style="display: none;">
                        <h3>Register</h3>
                        <input type="text" id="register-username" placeholder="Username">
                        <input type="email" id="register-email" placeholder="Email">
                        <input type="password" id="register-password" placeholder="Password">
                        <button id="register-btn">Register</button>
                        <p>Already have an account? <a href="#" id="show-login">Login</a></p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Leaderboard Modal -->
        <div id="leaderboard-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>Leaderboard</h2>
                <div id="leaderboard-content"></div>
                <button id="close-leaderboard">Close</button>
            </div>
        </div>
        
        <!-- Game Menu Modal -->
        <div id="game-menu-modal" class="modal" style="display: flex;">
            <div class="modal-content game-menu-styled" style="max-width: 680px; position: relative;">
                <button id="game-menu-close-btn" class="game-menu-close-btn" title="Close">×</button>
                <div class="game-menu-header">
                    <h2>KARDASHEV</h2>
                    <div class="game-menu-subtitle">DYSON SPHERE SIMULATOR</div>
                </div>
                <div id="game-menu-content">
                    <div class="game-menu-section-header">
                        <span class="section-line"></span>
                        <span class="section-title">SELECT STARTING CONDITIONS</span>
                        <span class="section-line"></span>
                    </div>
                    <div class="difficulty-buttons">
                        <button id="interstellar-game-btn" class="menu-btn difficulty-btn difficulty-interstellar">
                            <div class="difficulty-icon">✦</div>
                            <div class="difficulty-name">Interstellar</div>
                            <div class="difficulty-desc">1g Torch Drive<br>Complete Dyson Sphere<br>Ready for the Stars</div>
                        </button>
                        <button id="easy-game-btn" class="menu-btn difficulty-btn difficulty-easy">
                            <div class="difficulty-icon">◐</div>
                            <div class="difficulty-name">Easy</div>
                            <div class="difficulty-desc">100 Probes<br>10 Power Stations<br>10 Data Centers<br>1 Mass Driver</div>
                        </button>
                        <button id="medium-game-btn" class="menu-btn difficulty-btn difficulty-medium">
                            <div class="difficulty-icon">◑</div>
                            <div class="difficulty-name">Medium</div>
                            <div class="difficulty-desc">10 Probes<br>2 Power Stations<br>2 Data Centers</div>
                        </button>
                        <button id="hard-game-btn" class="menu-btn difficulty-btn difficulty-hard">
                            <div class="difficulty-icon">●</div>
                            <div class="difficulty-name">Hard</div>
                            <div class="difficulty-desc">1 Probe<br>No Structures</div>
                        </button>
                    </div>
                    <div id="load-game-section" class="load-game-section">
                        <div class="game-menu-section-header">
                            <span class="section-line"></span>
                            <span class="section-title">CONTINUE SIMULATION</span>
                            <span class="section-line"></span>
                        </div>
                        <div id="saved-games-list" class="saved-games-list">
                            <p style="text-align: center; color: #666; padding: 20px;">Loading saved games...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Skill Point Allocation Modal -->
        <div id="skill-allocation-modal" class="modal" style="display: none;">
            <div class="modal-content skill-allocation-content" style="max-width: 700px; padding: 25px 35px;">
                <h2 style="text-align: center; margin-bottom: 10px; color: #4a9eff;">Customize Your Start</h2>
                <p id="difficulty-label" style="text-align: center; color: #888; margin-bottom: 20px; font-size: 14px;">Medium Difficulty</p>
                
                <!-- Starting Planet Selection -->
                <div class="starting-planet-section" style="margin-bottom: 25px;">
                    <h3 style="color: #4a9eff; margin-bottom: 12px; font-size: 15px;">Starting Location</h3>
                    <div id="starting-planet-buttons" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="planet-btn" data-planet="mercury" style="flex: 1; min-width: 80px; padding: 12px 8px; background: #8C7853; color: white; border: 3px solid transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                            <div style="font-weight: bold; font-size: 13px;">Mercury</div>
                            <div style="font-size: 10px; opacity: 0.8; margin-top: 3px;">High solar</div>
                        </button>
                        <button class="planet-btn" data-planet="venus" style="flex: 1; min-width: 80px; padding: 12px 8px; background: #FFC649; color: #333; border: 3px solid transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                            <div style="font-weight: bold; font-size: 13px;">Venus</div>
                            <div style="font-size: 10px; opacity: 0.8; margin-top: 3px;">High energy</div>
                        </button>
                        <button class="planet-btn selected" data-planet="earth" style="flex: 1; min-width: 80px; padding: 12px 8px; background: #6B93D6; color: white; border: 3px solid #4a9eff; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                            <div style="font-weight: bold; font-size: 13px;">Earth</div>
                            <div style="font-size: 10px; opacity: 0.8; margin-top: 3px;">Balanced</div>
                        </button>
                        <button class="planet-btn" data-planet="mars" style="flex: 1; min-width: 80px; padding: 12px 8px; background: #CD5C5C; color: white; border: 3px solid transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                            <div style="font-weight: bold; font-size: 13px;">Mars</div>
                            <div style="font-size: 10px; opacity: 0.8; margin-top: 3px;">Good metal</div>
                        </button>
                        <button class="planet-btn" data-planet="asteroid_belt" style="flex: 1; min-width: 80px; padding: 12px 8px; background: #9E9E9E; color: white; border: 3px solid transparent; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                            <div style="font-weight: bold; font-size: 13px;">Asteroids</div>
                            <div style="font-size: 10px; opacity: 0.8; margin-top: 3px;">Rich mining</div>
                        </button>
                    </div>
                </div>
                
                <!-- Skill Points Allocation -->
                <div class="skill-points-section" style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: #4a9eff; margin: 0; font-size: 15px;">Skill Points</h3>
                        <div id="points-remaining" style="background: rgba(74, 158, 255, 0.2); padding: 6px 14px; border-radius: 15px; font-weight: bold; color: #4a9eff;">
                            10 points remaining
                        </div>
                    </div>
                    
                    <div class="skill-sliders" style="display: grid; gap: 12px;">
                        <!-- Mass Driver Velocity -->
                        <div class="skill-row" style="display: grid; grid-template-columns: 140px 1fr 80px; align-items: center; gap: 12px;">
                            <label style="color: #ccc; font-size: 13px;">Mass Driver Δv</label>
                            <input type="range" id="skill-mass-driver" class="skill-slider" min="0" max="10" value="0" style="width: 100%;">
                            <span class="skill-value" id="skill-mass-driver-value" style="text-align: right; color: #4a9eff; font-size: 13px;">+0.0 km/s</span>
                        </div>
                        
                        <!-- Probe Delta-V -->
                        <div class="skill-row" style="display: grid; grid-template-columns: 140px 1fr 80px; align-items: center; gap: 12px;">
                            <label style="color: #ccc; font-size: 13px;">Probe Δv</label>
                            <input type="range" id="skill-probe-dv" class="skill-slider" min="0" max="10" value="0" style="width: 100%;">
                            <span class="skill-value" id="skill-probe-dv-value" style="text-align: right; color: #4a9eff; font-size: 13px;">+0.0 km/s</span>
                        </div>
                        
                        <!-- Mining Rate -->
                        <div class="skill-row" style="display: grid; grid-template-columns: 140px 1fr 80px; align-items: center; gap: 12px;">
                            <label style="color: #ccc; font-size: 13px;">Mining Rate</label>
                            <input type="range" id="skill-mining" class="skill-slider" min="0" max="10" value="0" style="width: 100%;">
                            <span class="skill-value" id="skill-mining-value" style="text-align: right; color: #27ae60; font-size: 13px;">+0 kg/s</span>
                        </div>
                        
                        <!-- Replication Rate -->
                        <div class="skill-row" style="display: grid; grid-template-columns: 140px 1fr 80px; align-items: center; gap: 12px;">
                            <label style="color: #ccc; font-size: 13px;">Replication Rate</label>
                            <input type="range" id="skill-replication" class="skill-slider" min="0" max="10" value="0" style="width: 100%;">
                            <span class="skill-value" id="skill-replication-value" style="text-align: right; color: #27ae60; font-size: 13px;">+0 kg/s</span>
                        </div>
                        
                        <!-- Base Compute -->
                        <div class="skill-row" style="display: grid; grid-template-columns: 140px 1fr 80px; align-items: center; gap: 12px;">
                            <label style="color: #ccc; font-size: 13px;">Base Compute</label>
                            <input type="range" id="skill-compute" class="skill-slider" min="0" max="10" value="0" style="width: 100%;">
                            <span class="skill-value" id="skill-compute-value" style="text-align: right; color: #9b59b6; font-size: 13px;">+0%</span>
                        </div>
                        
                        <!-- Base Energy -->
                        <div class="skill-row" style="display: grid; grid-template-columns: 140px 1fr 80px; align-items: center; gap: 12px;">
                            <label style="color: #ccc; font-size: 13px;">Base Energy</label>
                            <input type="range" id="skill-energy" class="skill-slider" min="0" max="10" value="0" style="width: 100%;">
                            <span class="skill-value" id="skill-energy-value" style="text-align: right; color: #f1c40f; font-size: 13px;">+0%</span>
                        </div>
                        
                        <!-- Base Dexterity -->
                        <div class="skill-row" style="display: grid; grid-template-columns: 140px 1fr 80px; align-items: center; gap: 12px;">
                            <label style="color: #ccc; font-size: 13px;">Base Dexterity</label>
                            <input type="range" id="skill-dexterity" class="skill-slider" min="0" max="10" value="0" style="width: 100%;">
                            <span class="skill-value" id="skill-dexterity-value" style="text-align: right; color: #e74c3c; font-size: 13px;">+0%</span>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button id="skill-back-btn" style="padding: 12px 30px; background: rgba(255, 255, 255, 0.1); color: #ccc; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; cursor: pointer; font-size: 15px; transition: all 0.2s;">
                        ← Back
                    </button>
                    <button id="skill-start-btn" style="padding: 12px 40px; background: linear-gradient(135deg, #4a9eff 0%, #2878d8 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 15px; font-weight: bold; transition: all 0.2s;">
                        Start Game →
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Post-processing (EffectComposer, Bloom, God Rays) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/objects/Lensflare.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <!-- Game Scripts -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/utils/performance_profiler.js"></script>
    <script src="/static/js/utils/performance_tests.js"></script>
    <script src="/static/js/utils/calculation_cache.js"></script>
    <script src="/static/js/utils/format_utils.js"></script>
    <script src="/static/js/game/config.js"></script>
    <script src="/static/js/game/data_loader.js"></script>
    <script src="/static/js/game/skill_definitions.js"></script>
    <script src="/static/js/game/storage.js"></script>
    <!-- Calculation classes for UI (needed for delta-v overlay) -->
    <script src="/static/js/game/engine/calculations/orbital_mechanics.js"></script>
    <script src="/static/js/game/engine/calculations/tech_physics.js"></script>
    <script src="/static/js/game/engine/calculations/physics_bridge.js"></script>
    <script src="/static/js/game/engine/systems/transfer_system.js"></script>
    <!-- Worker-based engine architecture -->
    <script src="/static/js/game/client/state_manager.js"></script>
    <script src="/static/js/game/client/engine_client.js"></script>
    <!-- Legacy files (may still be needed by some UI components) -->
    <script src="/static/js/game/resources.js"></script>
    <script src="/static/js/game/upgrades.js"></script>
    <script src="/static/js/visualization/scene.js"></script>
    <script src="/static/js/visualization/starfield.js"></script>
    <script src="/static/js/visualization/solar_system.js"></script>
    <script src="/static/js/visualization/zone_clouds.js"></script>
    <script src="/static/js/visualization/structures.js"></script>
    <script src="/static/js/visualization/probes.js"></script>
    <script src="/static/js/visualization/dyson_sphere.js"></script>
    <script src="/static/js/visualization/transfers.js"></script>
    <script src="/static/js/visualization/star_map.js"></script>
    <script src="/static/js/visualization/star_map_galaxy.js"></script>
    <script src="/static/js/visualization/star_map_objects.js"></script>
    <script src="/static/js/visualization/star_map_ui.js"></script>
    <script src="/static/js/visualization/star_map_camera.js"></script>
    <script src="/static/js/visualization/star_map_fleets.js"></script>
    <script src="/static/js/visualization/star_map_poa.js"></script>
    <script src="/static/js/visualization/star_map_queue.js"></script>
    <script src="/static/js/ui/sidebar.js"></script>
    <script src="/static/js/ui/toast.js"></script>
    <script src="/static/js/ui/purchase_panel.js"></script>
    <script src="/static/js/ui/research_panel.js"></script>
    <script src="/static/js/ui/research_physics_display.js"></script>
    <script src="/static/js/ui/command_panel.js"></script>
    <script src="/static/js/ui/production_panel.js"></script>
    <script src="/static/js/ui/probe_panel.js"></script>
    <script src="/static/js/ui/manage_panel.js"></script>
    <script src="/static/js/ui/metrics_panel.js"></script>
        <script src="/static/js/ui/probe_summary_panel.js"></script>
        <script src="/static/js/ui/zone_info_panel.js"></script>
        <script src="/static/js/ui/transfer_panel.js"></script>
    <script src="/static/js/ui/resource_display.js?v=2"></script>
    <script src="/static/js/ui/probe_allocation.js"></script>
    <script src="/static/js/ui/orbital_zone_selector.js"></script>
    <script src="/static/js/ui/trajectory_planner.js"></script>
    <!-- Interstellar Navigation (Galaxy Mode) -->
    <script src="/static/js/game/engine/relativistic_travel.js"></script>
    <script src="/static/js/game/engine/galaxy_system.js"></script>
    <script src="/static/js/game/ui/star_map.js"></script>
    <script src="/static/js/game/ui/panels/drive_research_panel.js"></script>
    <script src="/static/js/game/ui/panels/stellar_census_panel.js"></script>
    <script src="/static/js/game/ui/interstellar_nav.js"></script>
    <!-- Universe Navigation (Phase 3 - Cosmic Web) -->
    <script src="/static/js/game/engine/universe_system.js"></script>
    <script src="/static/js/visualization/cosmic_web_generator.js"></script>
    <script src="/static/js/visualization/universe_map.js"></script>
    <script src="/static/js/ui/universe_panel.js"></script>
    <script src="/static/js/ui/energy_display.js"></script>
    <script src="/static/js/ui/scripting_window.js"></script>
    <script src="/static/js/ui/leaderboard.js"></script>
    <script src="/static/js/ui/time_controls.js"></script>
    <script src="/static/js/ui/performance_panel.js"></script>
    <script src="/static/js/ui/visual_effects_panel.js"></script>
    <script src="/static/js/ui/summary_plot_panel.js"></script>
    <script src="/static/js/ui/debug_panel.js"></script>
    <script src="/static/js/ui/loading_galaxy.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>

